<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mission Management</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 1rem; background: #f5f5f5; }
    section { margin-bottom: 2rem; }
    h2 { border-bottom: 1px solid #ccc; }
    input, button, textarea {
      margin-top: 0.5rem;
      display: block;
      padding: 0.5rem;
      font-size: 1rem;
    }
    #chatMessages, #commsLog, #fileList {
      border: 1px solid #ccc;
      height: 150px;
      overflow-y: auto;
      padding: 0.5rem;
    }
    #loginSection, #createAccountSection {
      max-width: 400px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .mission-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      background: #f9f9f9;
      border: 1px solid #ccc;
      margin-bottom: 0.5rem;
    }
    .deleteBtn {
      background-color: red;
      color: white;
      padding: 0.3rem 0.6rem;
      border: none;
    }
  </style>
</head>
<body>

<!-- LOGIN SECTION -->
<div id="loginSection">
  <h2>Mission Access</h2>
  <input type="text" id="usernameInput" placeholder="Username" />
  <input type="password" id="passwordInput" placeholder="Password" />
  <button id="loginBtn">Login</button>
  <button id="createAccountBtn">Create Account</button>
  <p id="loginError" style="color:red;"></p>
</div>

<!-- CREATE ACCOUNT SECTION -->
<div id="createAccountSection" style="display:none;">
  <h2>Request an Account</h2>
  <p>
    To request an account, please email <strong>Kendrick Uhles</strong> and CC <strong>Laramie Uhles</strong>.<br />
    Include your desired <strong>username</strong> and <strong>password</strong>.
  </p>
  <p>Email Kendrick: <a href="mailto:Kendrick.Uhles@cawgcap.org?cc=Laramie.Uhles@cawgcap.org&subject=Mission%20System%20Account%20Request">Kendrick.Uhles@cawgcap.org</a></p>
  <button id="backToLoginBtn">&larr; Back to Login</button>
</div>

<!-- MAIN APP SECTION -->
<div id="mainApp" style="display:none;">
  <h1>Mission Management</h1>

  <section id="missionListSection">
    <h2>Missions</h2>
    <input type="text" id="missionSearch" placeholder="Search missions..." />
    <button id="createMissionBtn">Create Mission</button>
    <div id="missionList"></div>
  </section>

  <section id="missionDetailSection" style="display:none;">
    <button id="backToListBtn">&larr; Back to Missions</button>
    <h2 id="currentMissionTitle"></h2>

    <section>
      <h3>Chat</h3>
      <div id="chatMessages"></div>
      <input type="text" id="chatInput" placeholder="Type a message" />
      <button id="sendChatBtn">Send</button>
    </section>

    <section>
      <h3>Comms Log</h3>
      <div id="commsLog"></div>
      <input type="text" id="commsInput" placeholder="Log entry" />
      <button id="logCommsBtn">Log</button>
    </section>

    <section>
      <h3>Files</h3>
      <input type="file" id="fileUpload" />
      <button id="uploadFileBtn">Upload</button>
      <ul id="fileList"></ul>
    </section>
  </section>
</div>

<script>
  const USERS = {
    "CommanderK": "SecurePass123",
    "LaramieU": "RadioOps456",
    "TestUser": "TestPass789"
  };

  const missions = [];
  let currentMission = null;

  const missionListEl = document.getElementById('missionList');
  const currentMissionTitleEl = document.getElementById('currentMissionTitle');
  const chatMessagesEl = document.getElementById('chatMessages');
  const commsLogEl = document.getElementById('commsLog');
  const fileListEl = document.getElementById('fileList');

  document.getElementById('loginBtn').onclick = () => {
    const user = document.getElementById('usernameInput').value.trim();
    const pass = document.getElementById('passwordInput').value;
    if (USERS[user] === pass) {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('mainApp').style.display = 'block';
    } else {
      document.getElementById('loginError').textContent = "Incorrect username or password.";
    }
  };

  document.getElementById('createAccountBtn').onclick = () => {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('createAccountSection').style.display = 'block';
  };

  document.getElementById('backToLoginBtn').onclick = () => {
    document.getElementById('createAccountSection').style.display = 'none';
    document.getElementById('loginSection').style.display = 'block';
  };

  document.getElementById('createMissionBtn').onclick = () => {
    const name = prompt('Enter mission name:');
    if (!name) return;
    const number = prompt('Enter mission number:');
    if (!number) return;
    const newMission = { name, number, chat: [], comms: [], files: [] };
    missions.push(newMission);
    renderMissionList();
  };

  function renderMissionList() {
    const filter = document.getElementById('missionSearch').value.toLowerCase();
    missionListEl.innerHTML = '';
    missions.filter(m => `${m.name} ${m.number}`.toLowerCase().includes(filter)).forEach((m, index) => {
      const div = document.createElement('div');
      div.className = 'mission-row';

      const label = document.createElement('span');
      label.textContent = `${m.name} (${m.number})`;

      const viewBtn = document.createElement('button');
      viewBtn.textContent = 'View';
      viewBtn.onclick = () => {
        currentMission = m;
        showMissionDetail();
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.className = 'deleteBtn';
      deleteBtn.onclick = () => {
        const confirmDelete = prompt('Type DELETE to confirm deleting this mission');
        if (confirmDelete === 'DELETE') {
          missions.splice(index, 1);
          renderMissionList();
        }
      };

      div.appendChild(label);
      div.appendChild(viewBtn);
      div.appendChild(deleteBtn);
      missionListEl.appendChild(div);
    });
  }

  document.getElementById('backToListBtn').onclick = () => {
    document.getElementById('missionListSection').style.display = 'block';
    document.getElementById('missionDetailSection').style.display = 'none';
    currentMission = null;
  };

  function showMissionDetail() {
    document.getElementById('missionListSection').style.display = 'none';
    document.getElementById('missionDetailSection').style.display = 'block';
    currentMissionTitleEl.textContent = `${currentMission.name} (${currentMission.number})`;
    renderChat();
    renderComms();
    renderFiles();
  }

  function renderChat() {
    chatMessagesEl.innerHTML = '';
    currentMission.chat.forEach(msg => {
      const div = document.createElement('div');
      div.textContent = msg;
      chatMessagesEl.appendChild(div);
    });
  }

  document.getElementById('sendChatBtn').onclick = () => {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    if (!msg || !currentMission) return;
    currentMission.chat.push(msg);
    input.value = '';
    renderChat();
  };

  function renderComms() {
    commsLogEl.innerHTML = '';
    currentMission.comms.forEach(log => {
      const div = document.createElement('div');
      div.textContent = log;
      commsLogEl.appendChild(div);
    });
  }

  document.getElementById('logCommsBtn').onclick = () => {
    const input = document.getElementById('commsInput');
    const log = input.value.trim();
    if (!log || !currentMission) return;
    currentMission.comms.push(log);
    input.value = '';
    renderComms();
  };

  function renderFiles() {
    fileListEl.innerHTML = '';
    currentMission.files.forEach(f => {
      const li = document.createElement('li');
      li.textContent = f.name;
      fileListEl.appendChild(li);
    });
  }

  document.getElementById('uploadFileBtn').onclick = () => {
    const fileInput = document.getElementById('fileUpload');
    if (!fileInput.files.length || !currentMission) return;
    currentMission.files.push({ name: fileInput.files[0].name });
    fileInput.value = '';
    renderFiles();
  };

  document.getElementById('missionSearch').oninput = renderMissionList;
  renderMissionList();
</script>

</body>
</html>
