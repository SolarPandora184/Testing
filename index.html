<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mission Selection</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    :root {
      --bg: #12161d;
      --panel: #1e232b;
      --accent: #2d333b;
      --text: #ffffff;
      --muted: #a0a0a0;
      --highlight: #3a8eed;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 1rem;
    }
    h1 { text-align: center; margin-bottom: 1rem; }
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--panel);
      color: var(--text);
    }
    th, td {
      padding: 0.75rem;
      border: 1px solid #333;
      text-align: left;
    }
    th {
      background: var(--accent);
    }
    tr:hover {
      background: #1c222b;
      cursor: pointer;
    }
    #filterInput {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      background: #2d333b;
      color: white;
      border: 1px solid #444;
      border-radius: 4px;
    }
    #addMissionBtn {
      background: var(--highlight);
      color: white;
      padding: 0.6rem 1rem;
      margin: 1rem 0;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
    }
    #missionForm {
      background: var(--panel);
      padding: 1rem;
      border-radius: 8px;
      display: none;
      margin-top: 1rem;
    }
    #missionForm input {
      width: 100%;
      margin-bottom: 0.5rem;
    }
    #missionForm button {
      background: var(--highlight);
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 4px;
      color: white;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Select a Mission</h1>
  <input type="text" id="filterInput" placeholder="Filter missions..." />
  <button id="addMissionBtn">+ Add Mission</button>

  <table>
    <thead>
      <tr>
        <th>Mission No</th>
        <th>Request No</th>
        <th>Mission Name</th>
        <th>Start</th>
        <th>End</th>
        <th>Location</th>
        <th>Type</th>
        <th>Air</th>
        <th>Ground</th>
      </tr>
    </thead>
    <tbody id="missionTableBody"></tbody>
  </table>

  <div id="missionForm">
    <h2>Add New Mission</h2>
    <input id="missionNo" placeholder="Mission No" />
    <input id="requestNo" placeholder="Request No" />
    <input id="name" placeholder="Mission Name" />
    <input id="start" placeholder="Start Date" />
    <input id="end" placeholder="End Date" />
    <input id="location" placeholder="Location" />
    <input id="type" placeholder="Mission Type" />
    <input id="air" placeholder="Air Resources" />
    <input id="ground" placeholder="Ground Resources" />
    <button onclick="submitMission()">Submit Mission</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAbkgmgqYqatkhmfDKnLHa4S52z9Jcz1lw",
      authDomain: "mission-9dd26.firebaseapp.com",
      databaseURL: "https://mission-9dd26-default-rtdb.firebaseio.com",
      projectId: "mission-9dd26",
      storageBucket: "mission-9dd26.appspot.com",
      messagingSenderId: "1080303837931",
      appId: "1:1080303837931:web:9b5ed2486bd6a2e70914ae"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const missionTableBody = document.getElementById("missionTableBody");
    const filterInput = document.getElementById("filterInput");
    const addMissionBtn = document.getElementById("addMissionBtn");
    const formDiv = document.getElementById("missionForm");

    addMissionBtn.onclick = () => {
      formDiv.style.display = formDiv.style.display === "none" ? "block" : "none";
    };

    function submitMission() {
      const mission = {
        missionNo: document.getElementById("missionNo").value,
        requestNo: document.getElementById("requestNo").value,
        name: document.getElementById("name").value,
        start: document.getElementById("start").value,
        end: document.getElementById("end").value,
        location: document.getElementById("location").value,
        type: document.getElementById("type").value,
        air: document.getElementById("air").value,
        ground: document.getElementById("ground").value,
        chat: [],
        comms: [],
        files: []
      };
      db.ref("missions").push(mission);
      formDiv.style.display = "none";
    }

    db.ref("missions").on("value", (snapshot) => {
      missionTableBody.innerHTML = "";
      const data = snapshot.val();
      if (data) {
        Object.entries(data).forEach(([key, mission]) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${mission.missionNo || ""}</td>
            <td>${mission.requestNo || ""}</td>
            <td>${mission.name || ""}</td>
            <td>${mission.start || ""}</td>
            <td>${mission.end || ""}</td>
            <td>${mission.location || ""}</td>
            <td>${mission.type || ""}</td>
            <td>${mission.air || ""}</td>
            <td>${mission.ground || ""}</td>`;
          tr.onclick = () => {
            localStorage.setItem("missionKey", key);
            window.location.href = "dashboard.html"; // You can change this path
          };
          missionTableBody.appendChild(tr);
        });
      }
    });

    filterInput.addEventListener("input", () => {
      const filter = filterInput.value.toLowerCase();
      Array.from(missionTableBody.children).forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(filter) ? "" : "none";
      });
    });
  </script>
</body>
</html>
